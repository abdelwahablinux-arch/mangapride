<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manga Pride - Lebanese Anime & Manga Web Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'deep-purple': '#4A306D',
                        'vibrant-pink': '#FF6B9D',
                        'electric-blue': '#2EC4B6',
                        'cedar-green': '#007A33',
                        'charcoal': '#1A1A1A',
                        'light-gray': '#F5F5F5',
                        'medium-gray': '#E0E0E0',
                    },
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                        'inter': ['Inter', 'sans-serif'],
                    },
                    animation: {
                        'scrollText': 'scrollText 15s linear infinite',
                    },
                    keyframes: {
                        scrollText: {
                            '0%': { transform: 'translateX(100%)' },
                            '100%': { transform: 'translateX(-100%)' },
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="font-inter text-charcoal bg-white">
    <!-- Top Bar -->
    <div class="bg-deep-purple text-white py-2 text-center text-sm">
        <p>Free shipping across Lebanon on orders over 10,000,000 LBP! üá±üáß</p>
    </div>

    <!-- Header & Navigation -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="flex justify-between items-center px-4 py-4 max-w-7xl mx-auto">
            <div class="flex items-center gap-2 cursor-pointer" onclick="showHomePage()">
                <i class="fas fa-dragon text-vibrant-pink text-2xl"></i>
                <h1 class="font-poppins font-bold text-2xl bg-gradient-to-r from-deep-purple to-vibrant-pink bg-clip-text text-transparent">Manga Pride</h1>
            </div>
            
            <ul class="hidden md:flex list-none gap-8">
                <li><a href="#" onclick="showHomePage()" class="no-underline text-charcoal font-medium hover:text-vibrant-pink transition-colors">Home</a></li>
                <li><a href="#" data-category="manga" class="no-underline text-charcoal font-medium hover:text-vibrant-pink transition-colors">Manga</a></li>
                <li><a href="#" data-category="figures" class="no-underline text-charcoal font-medium hover:text-vibrant-pink transition-colors">Figures</a></li>
                <li><a href="#" data-category="apparel" class="no-underline text-charcoal font-medium hover:text-vibrant-pink transition-colors">Apparel</a></li>
                <li><a href="#" data-category="accessories" class="no-underline text-charcoal font-medium hover:text-vibrant-pink transition-colors">Accessories</a></li>
                <li><a href="#" onclick="showTab('new-releases')" class="no-underline text-charcoal font-medium hover:text-vibrant-pink transition-colors">New Arrivals</a></li>
                <li><a href="#" class="no-underline text-charcoal font-medium hover:text-vibrant-pink transition-colors">Sale</a></li>
            </ul>
            
            <div class="flex gap-6 text-xl">
                <a href="#" onclick="focusSearch()" class="text-charcoal hover:text-vibrant-pink transition-colors"><i class="fas fa-search"></i></a>
                <a href="#" class="text-charcoal hover:text-vibrant-pink transition-colors"><i class="fas fa-user"></i></a>
                <a href="#" id="cart-icon" class="text-charcoal hover:text-vibrant-pink transition-colors relative">
                    <i class="fas fa-shopping-cart"></i>
                </a>
            </div>
            
            <button class="md:hidden bg-transparent border-none text-xl cursor-pointer">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <div id="main-content">
        <!-- Hero Section -->
        <section class="bg-gradient-to-br from-deep-purple/80 to-vibrant-pink/70 bg-cover bg-center text-white py-24 px-4 text-center relative" style="background-image: url('https://images.unsplash.com/photo-1639322537228-f710d846310a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1632&q=80')">
            <div class="max-w-4xl mx-auto">
                <h2 class="font-poppins font-bold text-4xl md:text-5xl mb-4 text-shadow-lg">Your Lebanese Gateway to the Anime Universe</h2>
                <p class="text-xl mb-8 text-shadow">Manga, Figures, Apparel & More ‚Äì Delivered Across Lebanon</p>
                
                <div class="flex max-w-2xl mx-auto mb-8">
                    <input type="text" id="main-search" placeholder="Search for your favorite anime, manga, or character..." class="flex-1 px-4 py-4 border-none rounded-l-full text-base text-charcoal">
                    <button onclick="performSearch()" class="bg-vibrant-pink text-white border-none px-6 rounded-r-full cursor-pointer hover:bg-pink-500 transition-colors"><i class="fas fa-search"></i></button>
                </div>
                
                <div class="flex flex-col sm:flex-row justify-center gap-4">
                    <button class="bg-vibrant-pink text-white px-6 py-3 rounded-full font-semibold no-underline inline-block cursor-pointer border-none hover:bg-pink-500 hover:-translate-y-1 hover:shadow-lg transition-all" onclick="showTab('featured')">Featured</button>
                    <button class="bg-electric-blue text-white px-6 py-3 rounded-full font-semibold no-underline inline-block cursor-pointer border-none hover:bg-teal-500 hover:-translate-y-1 hover:shadow-lg transition-all" onclick="showTab('new-releases')">New Releases</button>
                </div>
            </div>
        </section>

        <!-- Categories Section -->
        <section class="py-16 px-4 max-w-7xl mx-auto">
            <div class="text-center mb-12 relative">
                <h2 class="font-poppins font-bold text-3xl text-deep-purple inline-block">Explore Our Collection</h2>
                <div class="w-3/5 h-1 bg-gradient-to-r from-deep-purple to-vibrant-pink rounded mx-auto mt-2"></div>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
                <div class="rounded-xl overflow-hidden shadow-lg transition-all duration-300 cursor-pointer hover:-translate-y-2 hover:shadow-2xl" onclick="filterByCategory('manga')">
                    <img src="https://thumbs.dreamstime.com/b/japanese-manga-one-piece-comic-book-published-weekly-shonen-jump-magazine-series-written-illustrated-eiichiro-oda-142125624.jpg" alt="Manga Collection" class="w-full h-48 object-cover">
                    <h3 class="p-4 text-center bg-white text-deep-purple font-poppins font-bold">Manga</h3>
                </div>
                
                <div class="rounded-xl overflow-hidden shadow-lg transition-all duration-300 cursor-pointer hover:-translate-y-2 hover:shadow-2xl" onclick="filterByCategory('figures')">
                    <img src="https://p-bandai.com/files/seller-products/FSP0002658001/YYZPDAh3Uof8RH4Ede9c.webp" alt="Action Figures" class="w-full h-48 object-cover">
                    <h3 class="p-4 text-center bg-white text-deep-purple font-poppins font-bold">Action Figures</h3>
                </div>
                
                <div class="rounded-xl overflow-hidden shadow-lg transition-all duration-300 cursor-pointer hover:-translate-y-2 hover:shadow-2xl" onclick="filterByCategory('apparel')">
                    <img src="https://images.unsplash.com/photo-1523381210434-271e8be1f52b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80" alt="Anime Apparel" class="w-full h-48 object-cover">
                    <h3 class="p-4 text-center bg-white text-deep-purple font-poppins font-bold">Apparel</h3>
                </div>
                
                <div class="rounded-xl overflow-hidden shadow-lg transition-all duration-300 cursor-pointer hover:-translate-y-2 hover:shadow-2xl" onclick="filterByCategory('plushies')">
                    <img src="https://m.media-amazon.com/images/I/71DUihDpYlL._AC_UL1200_.jpg" alt="Plushies & Keychains" class="w-full h-48 object-cover">
                    <h3 class="p-4 text-center bg-white text-deep-purple font-poppins font-bold">Plushies & Keychains</h3>
                </div>
            </div>
        </section>

        <!-- Hot Picks Section -->
        <section class="py-16 px-4 bg-light-gray">
            <div class="max-w-7xl mx-auto">
                <div class="text-center mb-12 relative">
                    <h2 class="font-poppins font-bold text-3xl text-deep-purple inline-block">üî• Hot Picks</h2>
                    <p class="mt-2">Most loved by our community</p>
                    <div class="w-3/5 h-1 bg-gradient-to-r from-deep-purple to-vibrant-pink rounded mx-auto mt-2"></div>
                </div>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8" id="hot-picks-grid">
                    <div class="loading">Loading hot picks</div>
                </div>
            </div>
        </section>

        <!-- Products Tabs Section -->
        <section class="py-16 px-4 max-w-7xl mx-auto">
            <div class="flex justify-center mb-8 border-b-2 border-light-gray">
                <button class="px-8 py-4 cursor-pointer border-none bg-transparent text-lg font-semibold text-charcoal transition-all border-b-4 border-transparent active:text-vibrant-pink active:border-vibrant-pink" onclick="showTab('featured')">Featured</button>
                <button class="px-8 py-4 cursor-pointer border-none bg-transparent text-lg font-semibold text-charcoal transition-all border-b-4 border-transparent" onclick="showTab('new-releases')">New Releases</button>
                <button class="px-8 py-4 cursor-pointer border-none bg-transparent text-lg font-semibold text-charcoal transition-all border-b-4 border-transparent" onclick="showTab('bestsellers')">Bestsellers</button>
            </div>

            <!-- Featured Tab -->
            <div class="tab-content active" id="featured-tab">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8" id="featured-grid">
                    <div class="loading">Loading featured products</div>
                </div>
            </div>

            <!-- New Releases Tab -->
            <div class="tab-content hidden" id="new-releases-tab">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8" id="new-releases-grid">
                    <div class="loading">Loading new releases</div>
                </div>
            </div>

            <!-- Bestsellers Tab -->
            <div class="tab-content hidden" id="bestsellers-tab">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8" id="bestsellers-grid">
                    <div class="loading">Loading bestsellers</div>
                </div>
            </div>
        </section>
    </div>

    <!-- Search Results Page -->
    <div id="search-results" class="hidden p-8">
        <div class="inline-flex items-center gap-2 mb-8 text-deep-purple no-underline font-semibold cursor-pointer" onclick="showHomePage()">
            <i class="fas fa-arrow-left"></i>
            Back to Home
        </div>
        
        <div class="flex justify-between items-center mb-8">
            <h2 class="font-poppins font-bold text-2xl">Search Results</h2>
            <div class="text-medium-gray" id="results-count">0 results found</div>
        </div>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8" id="search-results-grid">
            <!-- Search results will be loaded here -->
        </div>
    </div>

    <!-- Text Scroller -->
    <div class="bg-gradient-to-r from-deep-purple to-vibrant-pink text-white py-2 text-center font-semibold relative overflow-hidden">
        <div class="inline-block whitespace-nowrap animate-scrollText">
            üöö FREE DELIVERY FOR ORDERS ABOVE 10,000,000 LBP ‚Ä¢ üéÅ FAST SHIPPING ACROSS LEBANON ‚Ä¢ ‚≠ê 100% AUTHENTIC PRODUCTS
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-charcoal text-white py-16 px-4">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 max-w-7xl mx-auto">
            <div>
                <h3 class="mb-6 text-electric-blue font-poppins font-bold text-xl">Manga Pride</h3>
                <p class="mb-4">Your Lebanese nakama for all things anime and manga. We bring the best of Japanese pop culture to Lebanon with a touch of local warmth.</p>
                <div class="flex gap-4 mt-4">
                    <a href="#" class="text-white text-xl hover:text-vibrant-pink transition-colors"><i class="fab fa-facebook-f"></i></a>
                    <a href="#" class="text-white text-xl hover:text-vibrant-pink transition-colors"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="text-white text-xl hover:text-vibrant-pink transition-colors"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="text-white text-xl hover:text-vibrant-pink transition-colors"><i class="fab fa-tiktok"></i></a>
                </div>
            </div>
            
            <div>
                <h3 class="mb-6 text-electric-blue font-poppins font-bold text-xl">Shop</h3>
                <ul class="list-none">
                    <li class="mb-2"><a href="#" data-category="manga" class="text-medium-gray no-underline hover:text-vibrant-pink transition-colors">Manga</a></li>
                    <li class="mb-2"><a href="#" data-category="figures" class="text-medium-gray no-underline hover:text-vibrant-pink transition-colors">Figures</a></li>
                    <li class="mb-2"><a href="#" data-category="apparel" class="text-medium-gray no-underline hover:text-vibrant-pink transition-colors">Apparel</a></li>
                    <li class="mb-2"><a href="#" data-category="accessories" class="text-medium-gray no-underline hover:text-vibrant-pink transition-colors">Accessories</a></li>
                    <li class="mb-2"><a href="#" onclick="showTab('new-releases')" class="text-medium-gray no-underline hover:text-vibrant-pink transition-colors">New Arrivals</a></li>
                    <li class="mb-2"><a href="#" class="text-medium-gray no-underline hover:text-vibrant-pink transition-colors">Sale Items</a></li>
                </ul>
            </div>
            
            <div>
                <h3 class="mb-6 text-electric-blue font-poppins font-bold text-xl">Help</h3>
                <ul class="list-none">
                    <li class="mb-2"><a href="#" class="text-medium-gray no-underline hover:text-vibrant-pink transition-colors">Shipping Information</a></li>
                    <li class="mb-2"><a href="#" class="text-medium-gray no-underline hover:text-vibrant-pink transition-colors">Returns & Exchanges</a></li>
                    <li class="mb-2"><a href="#" class="text-medium-gray no-underline hover:text-vibrant-pink transition-colors">Payment Methods</a></li>
                    <li class="mb-2"><a href="#" class="text-medium-gray no-underline hover:text-vibrant-pink transition-colors">FAQ</a></li>
                    <li class="mb-2"><a href="#" class="text-medium-gray no-underline hover:text-vibrant-pink transition-colors">Contact Us</a></li>
                </ul>
            </div>
            
            <div>
                <h3 class="mb-6 text-electric-blue font-poppins font-bold text-xl">Newsletter</h3>
                <p class="mb-4">Subscribe to get updates on new arrivals, special offers, and exclusive deals.</p>
                <div class="newsletter">
                    <input type="email" placeholder="Your email address" class="w-full px-4 py-2 mb-4 border-none rounded">
                    <button class="w-full bg-vibrant-pink text-white border-none px-6 py-2 rounded cursor-pointer font-semibold hover:bg-pink-500 transition-colors">Subscribe</button>
                </div>
            </div>
        </div>
        
        <div class="text-center mt-12 pt-8 border-t border-white/10 text-sm text-medium-gray max-w-7xl mx-auto">
            <p>&copy; 2023 Manga Pride. All rights reserved. | Designed with ‚ù§Ô∏è in Lebanon</p>
        </div>
    </footer>

    <!-- Cart Overlay -->
    <div class="cart-overlay fixed top-0 left-0 w-full h-full bg-black/50 z-40 hidden" id="cartOverlay"></div>

    <!-- Cart Modal -->
    <div class="cart-modal fixed top-0 right-[-400px] w-full sm:w-[400px] h-full bg-white shadow-2xl z-50 transition-all duration-300 overflow-hidden" id="cartModal">
        <div class="p-6 border-b border-medium-gray flex justify-between items-center bg-white">
            <h3 class="font-poppins font-bold text-lg text-deep-purple m-0">Your Cart</h3>
            <button class="btn-outline p-2 border-none bg-transparent text-charcoal text-xl cursor-pointer hover:bg-transparent hover:text-vibrant-pink" onclick="closeCart()" title="Close cart">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <!-- Free Shipping Progress Bar -->
        <div class="free-shipping-bar m-4 p-4 bg-light-gray rounded-xl text-center">
            <div class="shipping-text font-semibold text-charcoal mb-2" id="shippingText">
                Add 10,000,000 LBP for free shipping!
            </div>
            <div class="progress-container w-full h-2 bg-medium-gray rounded-full overflow-hidden my-2">
                <div class="progress-bar h-full bg-gradient-to-r from-electric-blue to-vibrant-pink rounded-full transition-all duration-500" id="shippingProgressBar"></div>
            </div>
            <div class="mini-shipping-indicator text-sm text-vibrant-pink font-semibold mt-2" id="miniShippingIndicator"></div>
        </div>
        
        <div class="cart-items p-4 h-[calc(100vh-200px)] overflow-y-auto bg-white" id="cartItems">
            <div class="empty-cart text-center p-12 text-medium-gray">
                <i class="fas fa-shopping-cart text-5xl mb-4 text-medium-gray"></i>
                <h3 class="font-poppins font-bold text-lg mb-2">Your cart is empty</h3>
                <p>Add some awesome anime merchandise!</p>
            </div>
        </div>
        <div class="cart-footer p-6 border-t border-medium-gray bg-white absolute bottom-0 w-full shadow-lg">
            <div class="cart-total flex justify-between font-bold text-xl mb-4 text-deep-purple">
                <span>Total:</span>
                <span id="cartTotal">0 LBP</span>
            </div>
            <div class="cart-buttons flex flex-col gap-2">
                <button class="bg-vibrant-pink text-white px-6 py-3 rounded font-semibold no-underline inline-block cursor-pointer border-none hover:bg-pink-500 transition-colors" onclick="checkout()">
                    <i class="fas fa-shopping-bag"></i> Checkout
                </button>
                <button class="bg-transparent border-2 border-deep-purple text-deep-purple px-6 py-3 rounded font-semibold no-underline inline-block cursor-pointer hover:bg-deep-purple hover:text-white transition-colors" onclick="closeCart()">
                    Continue Shopping
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = "https://remix-analysis-disco-first.trycloudflare.com";

        // Global variables
        let cart = JSON.parse(localStorage.getItem('mangaPrideCart')) || [];
        let allProducts = [];

        // Free shipping configuration
        const FREE_SHIPPING_THRESHOLD = 10000000;

        // Update free shipping progress
        function updateFreeShippingProgress() {
            const cartTotal = cart.reduce((sum, item) => sum + (parseFloat(item.price) * item.quantity), 0);
            const progressBar = document.getElementById('shippingProgressBar');
            const shippingText = document.getElementById('shippingText');
            const miniIndicator = document.getElementById('miniShippingIndicator');
            
            if (!progressBar || !shippingText) return;
            
            const progress = Math.min((cartTotal / FREE_SHIPPING_THRESHOLD) * 100, 100);
            const remaining = FREE_SHIPPING_THRESHOLD - cartTotal;
            
            progressBar.style.width = `${progress}%`;
            
            if (cartTotal >= FREE_SHIPPING_THRESHOLD) {
                shippingText.innerHTML = 'üéâ <span class="shipping-achieved text-cedar-green font-bold">You qualify for FREE shipping!</span>';
                progressBar.style.background = 'linear-gradient(90deg, #007A33, #2EC4B6)';
                if (miniIndicator) miniIndicator.innerHTML = '‚úì Free shipping unlocked!';
            } else {
                shippingText.innerHTML = `Add <strong>${formatPrice(remaining)} LBP</strong> for free shipping!`;
                progressBar.style.background = 'linear-gradient(90deg, #2EC4B6, #FF6B9D)';
                if (miniIndicator) miniIndicator.innerHTML = `${formatPrice(remaining)} LBP to free shipping`;
            }
        }

        // Update scroller text with current threshold
        function updateScrollerText() {
            const scroller = document.querySelector('.scroller-content');
            if (scroller) {
                scroller.innerHTML = 
                    `üöö FREE DELIVERY FOR ORDERS ABOVE ${formatPrice(FREE_SHIPPING_THRESHOLD)} LBP ‚Ä¢ ` +
                    `üéÅ FAST SHIPPING ACROSS LEBANON ‚Ä¢ ` +
                    `‚≠ê 100% AUTHENTIC PRODUCTS ‚Ä¢ ` +
                    `üì¶ CASH ON DELIVERY AVAILABLE`;
            }
        }

        // Update all shipping-related displays
        function updateShippingDisplays() {
            updateFreeShippingProgress();
            updateScrollerText();
        }

        // Cart functionality
        function updateCartCount() {
            const count = cart.reduce((total, item) => total + item.quantity, 0);
            let cartCount = document.querySelector('.cart-count');
            
            if (!cartCount) {
                const cartIcon = document.getElementById('cart-icon');
                cartCount = document.createElement('span');
                cartCount.className = 'cart-count absolute -top-2 -right-2 bg-vibrant-pink text-white rounded-full w-5 h-5 text-xs flex items-center justify-center font-semibold';
                cartIcon.appendChild(cartCount);
            }
            
            cartCount.textContent = count;
            cartCount.style.display = count > 0 ? 'flex' : 'none';
        }

        function openCart() {
            console.log('Opening cart...');
            document.getElementById('cartModal').classList.remove('right-[-400px]');
            document.getElementById('cartModal').classList.add('right-0');
            document.getElementById('cartOverlay').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            renderCartItems();
        }

        function closeCart() {
            console.log('Closing cart...');
            document.getElementById('cartModal').classList.remove('right-0');
            document.getElementById('cartModal').classList.add('right-[-400px]');
            document.getElementById('cartOverlay').classList.add('hidden');
            document.body.style.overflow = '';
        }

        function addToCart(product) {
            const existingItem = cart.find(item => item.id === product.id);
            
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    image: product.image,
                    quantity: 1
                });
            }
            
            localStorage.setItem('mangaPrideCart', JSON.stringify(cart));
            updateCartCount();
            updateShippingDisplays();
            showAlert(`Added ${product.name} to cart!`);
            
            if (document.getElementById('cartModal').classList.contains('right-0')) {
                renderCartItems();
            }
        }

        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            localStorage.setItem('mangaPrideCart', JSON.stringify(cart));
            updateCartCount();
            updateShippingDisplays();
            renderCartItems();
            showAlert('Item removed from cart!');
        }

        function updateQuantity(productId, change) {
            const item = cart.find(item => item.id === productId);
            if (item) {
                item.quantity += change;
                if (item.quantity <= 0) {
                    removeFromCart(productId);
                } else {
                    localStorage.setItem('mangaPrideCart', JSON.stringify(cart));
                    updateCartCount();
                    updateShippingDisplays();
                    renderCartItems();
                }
            }
        }

        function renderCartItems() {
            const container = document.getElementById('cartItems');
            const total = cart.reduce((sum, item) => sum + (parseFloat(item.price) * item.quantity), 0);
            
            document.getElementById('cartTotal').textContent = `${formatPrice(total)} LBP`;
            
            if (cart.length === 0) {
                container.innerHTML = `
                    <div class="empty-cart text-center p-12 text-medium-gray">
                        <i class="fas fa-shopping-cart text-5xl mb-4 text-medium-gray"></i>
                        <h3 class="font-poppins font-bold text-lg mb-2">Your cart is empty</h3>
                        <p>Add some awesome anime merchandise!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = cart.map(item => `
                <div class="cart-item flex gap-4 p-4 border-b border-light-gray bg-white">
                    <img src="${item.image}" alt="${item.name}" class="cart-item-image w-20 h-20 object-cover rounded-lg" onerror="this.src='https://images.unsplash.com/photo-1634017839464-5c339ebe3cb4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=735&q=80'">
                    <div class="cart-item-details flex-1">
                        <div class="cart-item-name font-semibold mb-2 text-charcoal">${item.name}</div>
                        <div class="cart-item-price text-deep-purple font-bold mb-2">${formatPrice(item.price)} LBP</div>
                        <div class="cart-item-quantity flex items-center gap-2 mt-2">
                            <button class="quantity-btn w-7 h-7 border border-medium-gray bg-white rounded flex items-center justify-center cursor-pointer font-bold hover:bg-light-gray" onclick="updateQuantity('${item.id}', -1)">-</button>
                            <span>${item.quantity}</span>
                            <button class="quantity-btn w-7 h-7 border border-medium-gray bg-white rounded flex items-center justify-center cursor-pointer font-bold hover:bg-light-gray" onclick="updateQuantity('${item.id}', 1)">+</button>
                        </div>
                    </div>
                    <button class="cart-item-remove bg-transparent border-none text-vibrant-pink cursor-pointer text-sm p-2 hover:text-pink-500" onclick="removeFromCart('${item.id}')" title="Remove item">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');
        }

        function checkout() {
            if (cart.length === 0) {
                showAlert('Your cart is empty!', 'error');
                return;
            }
            window.location.href = 'checkout.html';
        }

        function formatPrice(price) {
            return new Intl.NumberFormat('en-LB').format(price);
        }

        // Enhanced error handling for API calls
        async function loadProductsFromAPI() {
            try {
                showLoadingState();
                const apiUrl = `${API_BASE_URL}/api/products`;
                console.log('üåê Fetching from:', apiUrl);
                
                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    mode: 'cors'
                });
                
                console.log('üì° Response status:', response.status);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const products = await response.json();
                console.log('‚úÖ Loaded products from API:', products.length, 'products');
                allProducts = products;
                
                loadHotPicks();
                loadFeaturedProducts();
                loadNewReleases();
                loadBestsellers();
                
                return products;
            } catch (error) {
                console.error('‚ùå Error loading products:', error);
                
                // Show user-friendly error message
                showAlert('Cannot connect to server. Please try again later.', 'error');
                showErrorState();
                return [];
            }
        }

        // Enhanced server connectivity test
        async function testServerConnection() {
            try {
                console.log('üîç Testing server connection...');
                const response = await fetch(`${API_BASE_URL}/api/health`);
                const data = await response.json();
                console.log('‚úÖ Server is reachable:', data);
                return true;
            } catch (error) {
                console.error('‚ùå Server is not reachable:', error);
                return false;
            }
        }

        // Call this on page load
        testServerConnection();

        function showLoadingState() {
            const grids = ['hot-picks-grid', 'featured-grid', 'new-releases-grid', 'bestsellers-grid'];
            grids.forEach(gridId => {
                const grid = document.getElementById(gridId);
                if (grid) {
                    grid.innerHTML = '<div class="loading">Loading products from server...</div>';
                }
            });
        }

        function showErrorState() {
            const grids = ['hot-picks-grid', 'featured-grid', 'new-releases-grid', 'bestsellers-grid'];
            grids.forEach(gridId => {
                const grid = document.getElementById(gridId);
                if (grid) {
                    grid.innerHTML = `
                        <div class="col-span-full text-center p-8">
                            <i class="fas fa-exclamation-triangle text-5xl text-medium-gray mb-4"></i>
                            <h3 class="text-charcoal mb-4 font-poppins font-bold">Connection Error</h3>
                            <p class="text-medium-gray mb-4">Cannot connect to the server</p>
                            <p class="text-medium-gray text-sm mb-6">
                                Make sure the backend server is running and accessible
                            </p>
                            <button class="bg-vibrant-pink text-white px-6 py-3 rounded-full font-semibold no-underline inline-block cursor-pointer border-none hover:bg-pink-500 transition-colors mt-4" onclick="loadProductsFromAPI()">
                                <i class="fas fa-redo"></i> Try Again
                            </button>
                        </div>
                    `;
                }
            });
        }

        function loadHotPicks() {
            const hotPicks = allProducts.filter(product => product.is_hot);
            const grid = document.getElementById('hot-picks-grid');
            if (grid) {
                grid.innerHTML = hotPicks.length > 0 
                    ? hotPicks.map(product => createProductCard(product)).join('')
                    : '<div class="no-products">No hot picks available</div>';
            }
        }

        function loadFeaturedProducts() {
            const featured = allProducts.filter(product => product.is_featured);
            const grid = document.getElementById('featured-grid');
            if (grid) {
                grid.innerHTML = featured.length > 0 
                    ? featured.map(product => createProductCard(product)).join('')
                    : '<div class="no-products">No featured products available</div>';
            }
        }

        function loadNewReleases() {
            const newReleases = allProducts.filter(product => product.is_new);
            const grid = document.getElementById('new-releases-grid');
            if (grid) {
                grid.innerHTML = newReleases.length > 0 
                    ? newReleases.map(product => createProductCard(product)).join('')
                    : '<div class="no-products">No new releases available</div>';
            }
        }

        function loadBestsellers() {
            const bestsellers = allProducts.filter(product => product.is_bestseller);
            const grid = document.getElementById('bestsellers-grid');
            if (grid) {
                grid.innerHTML = bestsellers.length > 0 
                    ? bestsellers.map(product => createProductCard(product)).join('')
                    : '<div class="no-products">No bestsellers available</div>';
            }
        }

        function createProductCard(product) {
            const badgeClass = product.badge ? `badge-${product.badge}` : '';
            const badgeText = product.badge ? 
                product.badge.charAt(0).toUpperCase() + product.badge.slice(1) : '';
            
            const productImage = product.image || 'https://images.unsplash.com/photo-1634017839464-5c339ebe3cb4?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=735&q=80';
            
            return `
                <div class="product-card bg-white rounded-xl overflow-hidden shadow-lg transition-all duration-300 relative hover:-translate-y-1 hover:shadow-xl" data-category="${product.category}">
                    ${badgeText ? `<span class="product-badge absolute top-2 left-2 px-3 py-1 rounded-full text-white text-xs font-semibold z-10 ${badgeClass}">${badgeText}</span>` : ''}
                    <div class="heart-icon absolute top-2 right-2 bg-white/90 rounded-full w-10 h-10 flex items-center justify-center cursor-pointer transition-all duration-300 z-10 hover:bg-white hover:scale-110" onclick="toggleWishlist(this, '${product.id}')">
                        <i class="far fa-heart text-vibrant-pink text-lg transition-all duration-300"></i>
                    </div>
                    <img src="${productImage}" alt="${product.name}" class="product-image w-full h-64 object-cover">
                    <div class="product-info p-4">
                        <h3 class="product-title font-semibold mb-2 text-charcoal text-lg">${product.name}</h3>
                        <div class="product-category text-medium-gray text-sm mb-2">${getCategoryName(product.category)}</div>
                        <p class="product-price font-bold text-deep-purple mb-4 text-xl">${formatPrice(product.price)} LBP</p>
                        <div class="product-actions flex justify-between">
                            <button class="add-to-cart bg-vibrant-pink text-white border-none px-4 py-2 rounded cursor-pointer font-semibold hover:bg-pink-500 transition-colors flex-1 mr-2" onclick="addToCart(${JSON.stringify(product).replace(/"/g, '&quot;')})">
                                Add to Cart
                            </button>
                            <button class="wishlist bg-medium-gray border-none p-2 rounded cursor-pointer hover:bg-gray-300 transition-colors" onclick="toggleWishlist(this, '${product.id}')">
                                <i class="far fa-heart"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function getCategoryName(category) {
            const categories = {
                manga: 'Manga',
                figures: 'Figures',
                apparel: 'Apparel',
                plushies: 'Plushies & Keychains',
                accessories: 'Accessories'
            };
            return categories[category] || category;
        }

        function toggleWishlist(element, productId) {
            const icon = element.classList.contains('heart-icon') ? 
                element.querySelector('i') : element.querySelector('i');
            
            if (icon.classList.contains('far')) {
                icon.classList.remove('far');
                icon.classList.add('fas');
                icon.style.color = '#FF6B9D';
                if (element.classList.contains('heart-icon')) {
                    element.classList.add('active');
                }
                showAlert('Added to wishlist!');
            } else {
                icon.classList.remove('fas');
                icon.classList.add('far');
                icon.style.color = '';
                if (element.classList.contains('heart-icon')) {
                    element.classList.remove('active');
                }
                showAlert('Removed from wishlist!');
            }
        }

        function showAlert(message, type = 'success') {
            const alert = document.createElement('div');
            const backgroundColor = type === 'error' ? '#ff4444' : '#FF6B9D';
            
            alert.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: ${backgroundColor};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 5px;
                z-index: 10000;
                font-weight: 600;
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            `;
            alert.textContent = message;
            document.body.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 3000);
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.add('hidden');
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active', 'text-vibrant-pink', 'border-vibrant-pink');
            });
            
            document.getElementById(`${tabName}-tab`).classList.remove('hidden');
            document.getElementById(`${tabName}-tab`).classList.add('active');
            document.querySelector(`.tab[onclick="showTab('${tabName}')"]`).classList.add('active', 'text-vibrant-pink', 'border-vibrant-pink');
        }

        function filterByCategory(category) {
            const searchTerm = getCategoryName(category);
            document.getElementById('main-search').value = searchTerm;
            performSearch();
        }

        function performSearch() {
            const searchTerm = document.getElementById('main-search').value.toLowerCase().trim();
            
            if (!searchTerm) {
                showAlert('Please enter a search term');
                return;
            }

            const filteredProducts = allProducts.filter(product => 
                product.name.toLowerCase().includes(searchTerm) ||
                product.category.toLowerCase().includes(searchTerm) ||
                getCategoryName(product.category).toLowerCase().includes(searchTerm)
            );

            showSearchResults(filteredProducts, searchTerm);
        }

        function showSearchResults(results, searchTerm) {
            document.getElementById('main-content').classList.add('hidden');
            document.getElementById('search-results').classList.remove('hidden');
            
            document.getElementById('results-count').textContent = 
                `${results.length} result${results.length !== 1 ? 's' : ''} for "${searchTerm}"`;
            
            const grid = document.getElementById('search-results-grid');
            if (results.length > 0) {
                grid.innerHTML = results.map(product => createProductCard(product)).join('');
            } else {
                grid.innerHTML = `
                    <div class="col-span-full text-center p-12">
                        <i class="fas fa-search text-5xl text-medium-gray mb-4"></i>
                        <h3 class="text-charcoal mb-4 font-poppins font-bold">No products found</h3>
                        <p class="text-medium-gray mb-4">Try searching with different keywords</p>
                        <button class="bg-transparent border-2 border-deep-purple text-deep-purple px-6 py-3 rounded font-semibold no-underline inline-block cursor-pointer hover:bg-deep-purple hover:text-white transition-colors mt-4" onclick="showHomePage()">
                            Back to Home
                        </button>
                    </div>
                `;
            }
        }

        function showHomePage() {
            document.getElementById('main-content').classList.remove('hidden');
            document.getElementById('search-results').classList.add('hidden');
            document.getElementById('main-search').value = '';
        }

        function focusSearch() {
            document.getElementById('main-search').focus();
        }

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            updateCartCount();
            updateShippingDisplays();
            
            document.getElementById('cart-icon').addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                openCart();
            });
            
            document.getElementById('cartOverlay').addEventListener('click', closeCart);
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && document.getElementById('cartModal').classList.contains('right-0')) {
                    closeCart();
                }
            });
            
            document.getElementById('cartModal').addEventListener('click', function(e) {
                e.stopPropagation();
            });
            
            document.querySelectorAll('[data-category]').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const category = this.getAttribute('data-category');
                    filterByCategory(category);
                });
            });

            document.getElementById('main-search').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });

            loadProductsFromAPI();
        });

        // Mobile menu toggle
        document.querySelector('.mobile-menu-btn').addEventListener('click', function() {
            const navLinks = document.querySelector('.nav-links');
            navLinks.classList.toggle('hidden');
            navLinks.classList.toggle('flex');
        });
    </script>
</body>
</html>
